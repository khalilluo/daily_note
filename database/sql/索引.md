## 索引

索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如`gender`列，大约一半的记录值是`M`，另一半是`F`，因此，对该列创建索引就没有意义。

可以对一张表创建多个索引。索引的优点是**提高了查询效率**，**缺点是在插入、更新和删除记录时，需要同时修改索引**，**因此，索引越多，插入、更新和删除记录的速度就越慢**

**对于主键，关系数据库会自动对其创建主键索引**。使用主键索引的效率是最高的，因为主键会保证绝对唯一

```sql
# 在表device的mID列创建索引device_mID_index
# unique是可选的，如果该列是唯一的则可以设计成唯一索引
create [unique] index device_mID_index
   on device (mID);
   
# 语法
CREATE [UNIQUE] INDEX indexName ON 表名(列名(length));  # 创建索引
ALTER 表名 ADD [UNIQUE] INDEX [indexName] ON (列名(length))  # 修改表结构

# 创建表的时候创建索引
# fulltext为可选，包括unique|fulltext|spatial。分别表示唯一索引、全文索引和空间索引
create table indexTest(id integer primary key auto_increment, name char(20),fulltext index (id))
```

### 类型

1. 聚集索引（主键索引Clustered Index）：在数据库里面，所有行数都会按照主键索引进行排序。
2. 非聚集索引 (Unclustered Index)：就是给普通字段加上索引。
3. 联合索引：就是好几个字段组成的索引，称为联合索引。

### 索引的好处

1. 通过创建索引,可以在查询的过程中,提高系统的性能；
2. 通过创建唯一性索引,可以保证数据库表中每一行数据的唯一性；
3. 在使用分组和排序子句进行数据检索时,可以减少查询中分组和排序的时间；

### 索引的坏处

1. 创建索引和维护索引要耗费时间,而且时间随着数据量的增加而增大；
2. 索引需要占用物理空间,如果要建立聚簇索引,所需要的空间会更大；
3. 在对表中的数据进行增加删除和修改时需要耗费较多的时间,因为索引也要动态地维护；

### 建立索引的时机是什么

在WHERE和JOIN中出现的列需要建立索引，但也不完全如此，因为MySQL只对<，<=，=，>，>=，BETWEEN，IN，以及某些时候的LIKE才会使用索引（以通配符%和_开头作查询时，MySQL不会使用索引）


### 聚簇索引
按照每张表的主键构造一颗B+树，同时叶子节点中存放的就是整张表的行记录数据，也将聚集索引的叶子节点称为数据页。这个特性决定了索引组织表中数据也是索引的一部分，每张表只能拥有一个聚簇索引
Innodb通过主键聚集数据，如果没有定义主键，innodb会选择非空的唯一索引代替。如果没有这样的索引，innodb会隐式的定义一个主键来作为聚簇索引

优点：
数据访问更快，因为聚簇索引将索引和数据保存在同一个B+树中，因此从聚簇索引中获取数据比非聚簇索引更快
聚簇索引对于主键的排序查找和范围查找速度非常快

缺点：
插入速度严重依赖于插入顺序，按照主键的顺序插入是最快的方式，否则将会出现页分裂，严重影响性能。因此，对于InnoDB表，我们一般都会定义一个自增的ID列为主键
更新主键的代价很高，因为将会导致被更新的行移动

#### 辅助索引（非聚簇索引）

在聚簇索引之上创建的索引称之为辅助索引，辅助索引访问数据总是需要二次查找。辅助索引[叶子节点](https://so.csdn.net/so/search?q=%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9&spm=1001.2101.3001.7020)存储的不再是行的物理位置，而是主键值。通过辅助索引首先找到的是主键值，再通过主键值找到数据行的数据页。在innodb中有时也称辅助索引为二级索引