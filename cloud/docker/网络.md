```shell
docker create network dbmng
```

## 网络配置
### host
容器与宿主共用网络，这样就能在容器中访问宿主机网络，那么容器的localhost就是宿主机的localhost


### bridge
无法直接访问宿主机，因为网络数据通过docker0网卡访问宿主，很可能被防火墙拦截。而访问外部网络，docker 的 SNAT 网桥会将报文的源地址转换为宿主机的地址，通过宿主机的网卡向外发送

#### 解决
- 添加dokcer0网卡到防火墙信任列表firewall-cmd --zone=public --permanent --add-interface=eth0，这样就可以访问宿主机


## link机制

同一个宿主机上的多个docker容器之间如果想进行通信
1. 可以通过使用容器的ip地址来通信【前者会导致ip地址的硬编码，不方便迁移，并且容器重启后ip地址会改变，除非使用固定的ip】
2. 也可以通过宿主机的ip加上容器暴露出的端口号来通信【后者的通信方式比较单一，只能依靠监听在暴露出的端口的进程来进行有限的通信。】
3. 通过docker的link机制可以通过一个name来和另一个容器通信，link机制方便了容器去发现其它的容器并且可以安全的传递一些连接信息给其它的容器

### 使用

在nginx的容器中就可以使用db或者aliasdb作为连接地址来连接mysql服务，即使容器重启了，地址发生了变化，不会影响两个容器之间的连接
```shell
# 通过--link连接名为db的容器，并为其设置了别名aliasdb. 这个容器被称为received container
sudo docker run -d --name web --link db:aliasdb nginx
```

### 环境变量
docker将source container中定义的环境变量全部导入到received container
```shell 
docker exec db env

# 其中ALIASDB 是source容器别名
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=6337c0044215
ALIASDB_PORT=tcp://172.17.0.8:3306
ALIASDB_PORT_3306_TCP=tcp://172.17.0.8:3306
ALIASDB_PORT_3306_TCP_ADDR=172.17.0.8
ALIASDB_PORT_3306_TCP_PORT=3306
ALIASDB_PORT_3306_TCP_PROTO=tcp
ALIASDB_NAME=/web/aliasdb
ALIASDB_ENV_MYSQL_ROOT_PASSWORD=server
ALIASDB_ENV_MYSQL_MAJOR=5.5
ALIASDB_ENV_MYSQL_VERSION=5.5.48
NGINX_VERSION=1.9.10-1~jessie
HOME=/root
```

### 原理
这其实是通过给/etc/hosts中加入名称和IP的解析关系来实现的， 除此之外当目标容器重启，docker会负责更新/etc/hosts文件
使用link机制后，即使使用了`-icc=false`　两个容器之间也可以进行基于端口的通信

``` 
172.17.0.10 6337c0044215
127.0.0.1   localhost
::1 localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.17.0.8  aliasdb c1a7c7f091eb db
```